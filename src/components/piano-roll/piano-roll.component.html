<div class="piano-roll-container w-full p-4 flex flex-col gap-4">
  <h2 class="text-center text-lg">[ S.M.U.V.E 2.0 PIANO ROLL ]</h2>
  <div class="flex justify-between items-center p-2">
    <button class="button" (click)="togglePlay()">{{ isPlaying() ? '[ STOP ]' : '[ PLAY ]' }}</button>
    <button class="button" (click)="resetSequence()">[ RESET ]</button>
    <div>
      <label>Instrument:</label>
      <select [value]="selectedInstrument()" (change)="selectedInstrument.set($event.target.value)">
        @for(instrument of instruments; track instrument) {
          <option [value]="instrument">{{ instrument }}</option>
        }
      </select>
    </div>
    <div>
      <label>BPM: {{ bpm() }}</label>
      <input type="range" min="60" max="240" [value]="bpm()" (input)="onBpmChange($event)">
    </div>
  </div>
  <div class="w-full overflow-x-auto">
    <div class="piano-roll-grid grid" [style.grid-template-columns]="'80px repeat(16, 1fr)'">
      <div class="text-xs text-right pr-2"></div>
      @for(i of [].constructor(16); track i) { <div class="text-xs text-center">{{ i + 1 }}</div> }

      @for(note of allNotes; track note.midi) {
        <div class="piano-key text-xs text-right pr-2">{{ getNoteDisplay(note) }}</div>
        @for(step of sequence().get(note.midi) || []; track $index) {
          <div (click)="toggleNote(note.midi, $index)" class="note w-6 h-6 border"
            [class.vintage-note-active]="step"
            [class.vintage-note-playing]="currentStep() === $index">
          </div>
        }
      }
    </div>
  </div>
</div>
