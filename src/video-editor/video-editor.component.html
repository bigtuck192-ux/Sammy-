
<div class="w-full p-4 flex flex-col gap-4 relative h-full" [class]="'text-' + theme().neutral + '-200'" [class]="'border border-' + theme().accent + '-500/30'">
  <h2 class="text-center text-lg" [class]="'text-' + theme().accent + '-400'">[ AURA VIDEO LAB ]</h2>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-grow h-full">
    <!-- Left Panel: Controls & Input -->
    <div class="flex flex-col gap-4 p-4 border" [class]="'border-' + theme().accent + '-500/20'">

      <!-- Prompt Input -->
      <div>
        <label class="block mb-2 text-sm">[ VIDEO PROMPT ]</label>
        <textarea [(ngModel)]="videoPrompt" rows="4" class="w-full p-2 bg-black border text-sm font-mono" [class]="'border-' + theme().accent + '-500/50'" placeholder="Describe the video you want to generate..."></textarea>
      </div>

      <!-- Settings -->
      <div class="flex gap-2 items-center">
         <span class="text-sm">[ ASPECT ]</span>
         <button (click)="aspectRatio.set('16:9')" class="p-1 px-3 border text-xs" [class.bg-white]="aspectRatio() === '16:9'" [class.text-black]="aspectRatio() === '16:9'">16:9</button>
         <button (click)="aspectRatio.set('9:16')" class="p-1 px-3 border text-xs" [class.bg-white]="aspectRatio() === '9:16'" [class.text-black]="aspectRatio() === '9:16'">9:16</button>
      </div>

      <!-- Actions -->
      <div class="flex flex-col gap-2 mt-auto">
        @if (imageForVideoGeneration()) {
          <div class="p-2 border border-dashed flex items-center gap-2 mb-2" [class]="'border-' + theme().accent + '-500/30'">
             <img [src]="imageForVideoGeneration()" class="w-10 h-10 object-cover">
             <span class="text-xs">Image reference loaded</span>
          </div>
          <button (click)="generateVideo(true)" [disabled]="isGeneratingVideo() || !videoPrompt() || !isAiAvailable()" class="p-3 border font-bold hover:bg-white hover:text-black disabled:opacity-50 disabled:cursor-not-allowed">
             {{ isGeneratingVideo() ? '[ GENERATING... ]' : '[ GENERATE FROM IMAGE ]' }}
          </button>
        }

        <button (click)="generateVideo(false)" [disabled]="isGeneratingVideo() || !videoPrompt() || !isAiAvailable()" class="p-3 border font-bold hover:bg-white hover:text-black disabled:opacity-50 disabled:cursor-not-allowed">
            {{ isGeneratingVideo() ? '[ GENERATING... ]' : '[ GENERATE FROM TEXT ]' }}
        </button>
      </div>

      <!-- Webcam Preview -->
      <div class="relative border min-h-[150px] bg-black" [class]="'border-' + theme().accent + '-500/30'">
         <video #liveVideoPreview autoplay playsinline muted class="w-full h-full object-cover"></video>
         <button (click)="toggleCamera()" class="absolute bottom-2 right-2 p-1 border text-xs bg-black/80 hover:bg-white hover:text-black">
            {{ mediaStream() ? '[ STOP CAM ]' : '[ START CAM ]' }}
         </button>
      </div>

    </div>

    <!-- Right Panel: Output -->
    <div class="flex flex-col gap-4 p-4 border relative" [class]="'border-' + theme().accent + '-500/20'">
       <div class="absolute top-2 right-2 flex gap-2">
         @if (isGeneratingVideo()) { <span class="animate-pulse text-xs">[ PROCESSING ]</span> }
       </div>

       <div class="flex-grow flex items-center justify-center border-2 border-dashed p-2 min-h-[300px]" [class]="'border-' + theme().accent + '-700/50'">
          @if (generatedVideoUrl()) {
             <video [src]="generatedVideoUrl()" controls autoplay loop class="max-w-full max-h-full"></video>
          } @else if (isGeneratingVideo()) {
             <div class="text-center">
               <div class="mb-2">Creating Video...</div>
               <div class="text-xs opacity-70">{{ generationProgressMessage() }}</div>
               <div class="mt-4 w-32 h-1 bg-gray-800 mx-auto overflow-hidden">
                  <div class="h-full bg-white animate-pulse w-1/2 mx-auto"></div>
               </div>
             </div>
          } @else {
             <span class="opacity-50">[ GENERATED VIDEO OUTPUT ]</span>
          }
       </div>

       @if (error()) {
         <div class="p-2 border border-red-500 bg-red-900/20 text-red-400 text-xs">
           {{ error() }}
         </div>
       }
    </div>
  </div>
</div>
